/*******************************************************************************
* KindEditor - WYSIWYG HTML Editor for Internet
* Copyright (C) 2006-2022 kindeditor.net
*
* @author Roddy <luolonghao@gmail.com>
* @site http://kindeditor.net/
* @licence http://kindeditor.net/license.php
*******************************************************************************/

KindEditor.plugin('emoticons', function (K) {
    var self = this, name = 'emoticons',
        emojis = {
            faces: ['ğŸ˜€', 'ğŸ˜', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜…', 'ğŸ˜†', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‹', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜˜', 'ğŸ¥°', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ™‚', 'ğŸ¤—', 'ğŸ¤©', 'ğŸ¤”', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ™„', 'ğŸ˜', 'ğŸ˜£', 'ğŸ˜¥', 'ğŸ˜®', 'ğŸ¤', 'ğŸ˜¯', 'ğŸ˜ª', 'ğŸ˜«', 'ğŸ˜´', 'ğŸ˜Œ', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ˜', 'ğŸ¤¤', 'ğŸ˜’', 'ğŸ˜“', 'ğŸ˜”', 'ğŸ˜•', 'ğŸ™ƒ', 'ğŸ¤‘', 'ğŸ˜²', 'ğŸ™', 'ğŸ˜–', 'ğŸ˜', 'ğŸ˜Ÿ', 'ğŸ˜¤', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜©', 'ğŸ¤¯', 'ğŸ˜¬', 'ğŸ˜°', 'ğŸ˜±', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜³', 'ğŸ¤ª', 'ğŸ˜µ', 'ğŸ˜¡', 'ğŸ˜ ', 'ğŸ¤¬', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ˜‡', 'ğŸ¤ ', 'ğŸ¤¡', 'ğŸ¥³', 'ğŸ¥´', 'ğŸ¥º', 'ğŸ¤¥', 'ğŸ¤«', 'ğŸ¤­', 'ğŸ§', 'ğŸ¤“'],
            hands: ['ğŸ¤²', 'ğŸ‘', 'ğŸ™Œ', 'ğŸ‘', 'ğŸ¤', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘Š', 'âœŠ', 'ğŸ¤›', 'ğŸ¤œ', 'ğŸ¤', 'âœŒï¸', 'ğŸ¤Ÿ', 'ğŸ¤˜', 'ğŸ‘Œ', 'ğŸ‘ˆ', 'ğŸ‘‰', 'ğŸ‘†', 'ğŸ‘‡', 'â˜ï¸', 'âœ‹', 'ğŸ¤š', 'ğŸ–', 'ğŸ––', 'ğŸ‘‹', 'ğŸ¤™', 'ğŸ’ª', 'ğŸ¦µ', 'ğŸ¦¶', 'ğŸ–•', 'âœï¸', 'ğŸ™', 'ğŸ‘ğŸ»', 'ğŸ™ŒğŸ»', 'ğŸ‘ğŸ»', 'ğŸ™ğŸ»', 'ğŸ‘ğŸ»', 'ğŸ‘ğŸ»', 'ğŸ‘ŠğŸ»', 'âœŠğŸ»', 'ğŸ¤›ğŸ»', 'ğŸ¤œğŸ»', 'ğŸ¤ğŸ»', 'âœŒğŸ»', 'ğŸ¤ŸğŸ»', 'ğŸ¤˜ğŸ»', 'ğŸ‘ŒğŸ»', 'ğŸ‘ˆğŸ»', 'ğŸ‘‰ğŸ»', 'ğŸ‘†ğŸ»', 'ğŸ‘‡ğŸ»', 'â˜ğŸ»', 'âœ‹ğŸ»', 'ğŸ¤šğŸ»', 'ğŸ–ğŸ»', 'ğŸ––ğŸ»', 'ğŸ‘‹ğŸ»', 'ğŸ¤™ğŸ»', 'ğŸ’ªğŸ»', 'ğŸ–•ğŸ»', 'âœğŸ»', 'ğŸ¤²ğŸ¾', 'ğŸ‘ğŸ¾', 'ğŸ™ŒğŸ¾', 'ğŸ‘ğŸ¾', 'ğŸ™ğŸ¾', 'ğŸ‘ğŸ¾', 'ğŸ‘ğŸ¾', 'ğŸ‘ŠğŸ¾', 'âœŠğŸ¾', 'ğŸ¤›ğŸ¾', 'ğŸ¤œğŸ¾', 'ğŸ¤ğŸ¾', 'âœŒğŸ¾', 'ğŸ¤ŸğŸ¾', 'ğŸ¤˜ğŸ¾', 'ğŸ‘ŒğŸ¾', 'ğŸ‘ˆğŸ¾', 'ğŸ‘‰ğŸ¾', 'ğŸ‘†ğŸ¾', 'ğŸ‘‡ğŸ¾', 'â˜ğŸ¾', 'âœ‹ğŸ¾', 'ğŸ¤šğŸ¾', 'ğŸ–ğŸ¾', 'ğŸ––ğŸ¾', 'ğŸ‘‹ğŸ¾', 'ğŸ¤™ğŸ¾', 'ğŸ’ªğŸ¾', 'ğŸ–•ğŸ¾', 'âœğŸ¾'],
            avatar: ['ğŸ‘¶ğŸ»', 'ğŸ‘¦ğŸ»', 'ğŸ‘§ğŸ»', 'ğŸ‘¨ğŸ»', 'ğŸ‘©ğŸ»', 'ğŸ‘±ğŸ»â€â™€ï¸', 'ğŸ‘±ğŸ»', 'ğŸ‘´ğŸ»', 'ğŸ‘µğŸ»', 'ğŸ‘²ğŸ»', 'ğŸ‘³ğŸ»â€â™€ï¸', 'ğŸ‘³ğŸ»', 'ğŸ‘®ğŸ»â€â™€ï¸', 'ğŸ‘®ğŸ»', 'ğŸ‘·ğŸ»â€â™€ï¸', 'ğŸ‘·ğŸ»', 'ğŸ’‚ğŸ»â€â™€ï¸', 'ğŸ’‚ğŸ»', 'ğŸ•µğŸ»â€â™€ï¸', 'ğŸ•µğŸ»', 'ğŸ‘©ğŸ»â€âš•ï¸', 'ğŸ‘¨ğŸ»â€âš•ï¸', 'ğŸ‘©ğŸ»â€ğŸŒ¾', 'ğŸ‘¨ğŸ»â€ğŸŒ¾', 'ğŸ‘©ğŸ»â€ğŸ³', 'ğŸ‘¨ğŸ»â€ğŸ³', 'ğŸ‘©ğŸ»â€ğŸ“', 'ğŸ‘¨ğŸ»â€ğŸ“', 'ğŸ‘©ğŸ»â€ğŸ¤', 'ğŸ‘¨ğŸ»â€ğŸ¤', 'ğŸ‘©ğŸ»â€ğŸ«', 'ğŸ‘¨ğŸ»â€ğŸ«', 'ğŸ‘©ğŸ»â€ğŸ­', 'ğŸ‘¨ğŸ»â€ğŸ­', 'ğŸ‘©ğŸ»â€ğŸ’»', 'ğŸ‘¨ğŸ»â€ğŸ’»', 'ğŸ‘©ğŸ»â€ğŸ’¼', 'ğŸ‘¨ğŸ»â€ğŸ’¼', 'ğŸ‘©ğŸ»â€ğŸ”§', 'ğŸ‘¨ğŸ»â€ğŸ”§', 'ğŸ‘©ğŸ»â€ğŸ”¬', 'ğŸ‘¨ğŸ»â€ğŸ”¬', 'ğŸ‘©ğŸ»â€ğŸ¨', 'ğŸ‘¨ğŸ»â€ğŸ¨', 'ğŸ‘©ğŸ»â€ğŸš’', 'ğŸ‘¨ğŸ»â€ğŸš’', 'ğŸ‘©ğŸ»â€âœˆï¸', 'ğŸ‘¨ğŸ»â€âœˆï¸', 'ğŸ‘©ğŸ»â€ğŸš€', 'ğŸ‘¨ğŸ»â€ğŸš€', 'ğŸ‘©ğŸ»â€âš–ï¸', 'ğŸ‘¨ğŸ»â€âš–ï¸', 'ğŸ¤¶ğŸ»', 'ğŸ…ğŸ»', 'ğŸ‘¸ğŸ»', 'ğŸ¤´ğŸ»', 'ğŸ‘°ğŸ»', 'ğŸ¤µğŸ»', 'ğŸ‘¼ğŸ»', 'ğŸ¤°ğŸ»', 'ğŸ™‡ğŸ»â€â™€ï¸', 'ğŸ™‡ğŸ»', 'ğŸ’ğŸ»', 'ğŸ’ğŸ»â€â™‚ï¸', 'ğŸ™…ğŸ»', 'ğŸ™…ğŸ»â€â™‚ï¸', 'ğŸ™†ğŸ»', 'ğŸ™†ğŸ»â€â™‚ï¸', 'ğŸ™‹ğŸ»', 'ğŸ™‹ğŸ»â€â™‚ï¸', 'ğŸ¤¦ğŸ»â€â™€ï¸', 'ğŸ¤¦ğŸ»â€â™‚ï¸', 'ğŸ¤·ğŸ»â€â™€ï¸', 'ğŸ¤·ğŸ»â€â™‚ï¸', 'ğŸ™ğŸ»', 'ğŸ™ğŸ»â€â™‚ï¸', 'ğŸ™ğŸ»', 'ğŸ™ğŸ»â€â™‚ï¸', 'ğŸ’‡ğŸ»', 'ğŸ’‡ğŸ»â€â™‚ï¸', 'ğŸ’†ğŸ»', 'ğŸ’†ğŸ»â€â™‚ï¸', 'ğŸ•´ğŸ»', 'ğŸ’ƒğŸ»', 'ğŸ•ºğŸ»', 'ğŸš¶ğŸ»â€â™€ï¸', 'ğŸš¶ğŸ»', 'ğŸƒğŸ»â€â™€ï¸', 'ğŸƒğŸ»'],
            foods: ['ğŸ', 'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ', 'ğŸ¥­', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥’', 'ğŸ¥¬', 'ğŸŒ¶', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ¥”', 'ğŸ ', 'ğŸ¥', 'ğŸ', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ¥¯', 'ğŸ§€', 'ğŸ¥š', 'ğŸ³', 'ğŸ¥', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ¥ª', 'ğŸ¥™', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ¥«', 'ğŸ', 'ğŸœ', 'ğŸ²', 'ğŸ›', 'ğŸ£', 'ğŸ±', 'ğŸ¥Ÿ', 'ğŸ¤', 'ğŸ™', 'ğŸš', 'ğŸ˜', 'ğŸ¥', 'ğŸ¥®', 'ğŸ¥ ', 'ğŸ¢', 'ğŸ¡', 'ğŸ§', 'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ°', 'ğŸ‚', 'ğŸ®', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿', 'ğŸ§‚', 'ğŸ©', 'ğŸª', 'ğŸŒ°', 'ğŸ¥œ', 'ğŸ¯', 'ğŸ¥›', 'ğŸ¼', 'â˜•ï¸', 'ğŸµ', 'ğŸ¥¤', 'ğŸ¶', 'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ·', 'ğŸ¥ƒ', 'ğŸ¸', 'ğŸ¹', 'ğŸ¾', 'ğŸ¥„', 'ğŸ´', 'ğŸ½', 'ğŸ¥£', 'ğŸ¥¡', 'ğŸ¥¢'],
            animals: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ¦', 'ğŸ»', 'ğŸ¼', 'ğŸ¦˜', 'ğŸ¦¡', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦¢', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸš', 'ğŸ', 'ğŸœ', 'ğŸ¦—', 'ğŸ•·', 'ğŸ•¸', 'ğŸ¦‚', 'ğŸ¦Ÿ', 'ğŸ¦ ', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦€', 'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦', 'ğŸ˜', 'ğŸ¦', 'ğŸ¦›', 'ğŸª', 'ğŸ«', 'ğŸ¦™', 'ğŸ¦’', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ', 'ğŸ–', 'ğŸ', 'ğŸ‘', 'ğŸ', 'ğŸ¦Œ', 'ğŸ•', 'ğŸ©', 'ğŸˆ', 'ğŸ“', 'ğŸ¦ƒ', 'ğŸ•Š', 'ğŸ‡', 'ğŸ', 'ğŸ€', 'ğŸ¿', 'ğŸ¦”', 'ğŸ¾', 'ğŸ‰', 'ğŸ²'],
            nature: ['ğŸŒµ', 'ğŸ„', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒ±', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€', 'ğŸ', 'ğŸ‹', 'ğŸƒ', 'ğŸ‚', 'ğŸ', 'ğŸ„', 'ğŸŒ¾', 'ğŸ’', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ¥€', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ›', 'ğŸŒœ', 'ğŸŒš', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜', 'ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ™', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸ’«', 'â­ï¸', 'ğŸŒŸ', 'âœ¨', 'âš¡ï¸', 'â˜„ï¸', 'ğŸ’¥', 'ğŸ”¥', 'ğŸŒª', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ¤', 'â›…ï¸', 'ğŸŒ¥', 'â˜ï¸', 'ğŸŒ¦', 'ğŸŒ§', 'â›ˆ', 'ğŸŒ©', 'ğŸŒ¨', 'â„ï¸', 'â˜ƒï¸', 'â›„ï¸', 'ğŸŒ¬', 'ğŸ’¨', 'ğŸ’§', 'ğŸ’¦', 'â˜”ï¸', 'â˜‚ï¸'],
            tags: ['â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ğŸ•‰', 'â˜¸ï¸', 'âœ¡ï¸', 'ğŸ”¯', 'ğŸ•', 'â˜¯ï¸', 'â˜¦ï¸', 'ğŸ›', 'â›', 'â™ˆï¸', 'â™‰ï¸', 'â™Šï¸', 'â™‹ï¸', 'â™Œï¸', 'â™ï¸', 'â™ï¸', 'â™ï¸', 'â™ï¸', 'â™‘ï¸', 'â™’ï¸', 'â™“ï¸', 'ğŸ†”', 'ğŸš»', 'ğŸš®', 'ğŸ¦', 'ğŸ“¶', 'ğŸˆ', 'ğŸ”£', 'â„¹ï¸', 'ğŸ”¤', 'ğŸ”¡', 'ğŸ” ', 'ğŸ†–', 'ğŸ†—', 'ğŸ†™', 'ğŸ†’', 'ğŸ†•', 'ğŸ†“', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ğŸ”Ÿ', 'ğŸ”¢', '#ï¸âƒ£', '*ï¸âƒ£', 'âï¸', 'â–¶ï¸', 'â¸', 'â¯', 'â¹', 'âº', 'â­', 'â®', 'â©', 'âª', 'â«', 'â¬', 'â—€ï¸', 'ğŸ”¼', 'ğŸ”½', 'â¡ï¸', 'â¬…ï¸', 'â¬†ï¸', 'â¬‡ï¸', 'â†—ï¸', 'â†˜ï¸', 'â†™ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†ªï¸', 'â†©ï¸', 'â¤´ï¸', 'â¤µï¸', 'ğŸ”€', 'ğŸ”', 'ğŸ”‚', 'ğŸ”„', 'ğŸ”ƒ'],
        },
        page = {
            cols: 10,
            total: Object.keys(emojis),
            current: 'faces',
            tags: {
                faces: 'è¡¨æƒ…',
                hands: 'æ‰‹åŠ¿',
                avatar: 'å¤´åƒ',
                foods: 'é£Ÿç‰©',
                animals: 'åŠ¨ç‰©',
                nature: 'è‡ªç„¶',
                tags: 'ç¬¦å·'
            }
        };
	if(self.emojiConfig && self.emojiConfig instanceof Function){
		self.emojiConfig.call(null, emojis, page);
	}
    self.clickToolbar(name, function () {
        var elements = [];
        var wrapperDiv = K('<div class="ke-plugin-emoji"></div>'),
            menu = self.createMenu({
                name: name,
                beforeRemove: function () {
                    removeEvent();
                }
            });
		var iconLeft = K(".ke-toolbar .ke-icon-emoticons").pos().x;
		var iconWidth = K(".ke-toolbar .ke-icon-emoticons").width();
		var winWidth = K(document.body).width();
        menu.div.append(wrapperDiv);

        function bindCellEvent(cell, emoji) {
            cell.mouseover(function () {
                K(this).addClass('ke-on');
            });
            cell.mouseout(function () {
                K(this).removeClass('ke-on');
            });
            cell.click(function (e) {
                self.insertHtml(emoji).hideMenu();
                setTimeout(function(){
                    self.focus(); 
                    self.cmd.select();
                    self.cmd.selection(true);
                }, 1e2);
                e.stop();
            });
        }
        function emojiTable(key, parent) {
            var tableDom = document.createElement('ul');
            parent.append(tableDom);
            tableDom.className = 'ke-ul';
            //tableDom.cellPadding = 0;
            //tableDom.cellSpacing = 0;
            //tableDom.border = 0;
            var rows = Math.ceil(emojis[key].length / page.cols);
            var emoji;
            for (var i = 0; i < rows; i++) {
                var row = document.createElement('li');
                K(row).addClass('ke-li');
                K(tableDom).append(row)
                for (var j = 0; j < page.cols; j++) {
                    // var cell = K(row.insertCell(j));
                    // cell.addClass('ke-cell');
                    emoji = emojis[key][(page.cols * i) + j];
                    if (emoji === undefined) {
                        continue;
                    }
                    var span = K('<span class="ke-emoji">' + emoji + '</span>');
                    bindCellEvent(span, emoji);
                    K(row).append(span);
                    elements.push(span);
                }
            }
            return tableDom;
        }
        var table = emojiTable(page.current, wrapperDiv), pageDiv;
		var tableWidth = K(wrapperDiv).width();
		if((iconLeft + tableWidth) > winWidth){
			K(menu.div).css({
				left: iconLeft - (tableWidth - iconWidth) + 'px'
			})
		}
        function removeEvent() {
            K.each(elements, function () {
                this.unbind();
            });
        }
        function bindPageEvent(el, key) {
            el.click(function (e) {
                removeEvent();
                table.parentNode.removeChild(table);
                pageDiv.remove();
                table = emojiTable(key, wrapperDiv);
                createPageTable(key);
                page.current = key;
                e.stop();
            });
        }
        function createPageTable(tagname) {
            pageDiv = K('<div class="ke-page"></div>');
            wrapperDiv.append(pageDiv);
            for (var key in page.tags) {
                var keyname = page.tags[key];
                if (key !== tagname) {
                    var tag = K('<span class="ke-page-item"><a href="javascript:;">[' + keyname + ']</a></span>');
                    bindPageEvent(tag, key);
                    pageDiv.append(tag);
                    elements.push(tag);
                } else {
                    pageDiv.append(K('<span class="ke-page-item">[' + keyname + ']</span>'));
                }
                // pageDiv.append(K('@&nbsp;'));
            }
        }
        createPageTable(page.current);
		// console.info(K,menu.div)
    });
});